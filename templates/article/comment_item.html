{% load static %}
<div class="comment-item mb-4 d-flex gap-3">
    <!-- Avatar Section -->
    <div class="flex-shrink-0">
        <a href="{% url 'user_urls:profile' comment.comment_author.username %}">
            {% if comment.comment_author.profile_picture %}
            <img src="{{ comment.comment_author.profile_picture.url }}" alt="@{{ comment.comment_author.username }}"
                class="img-fluid" style="width: 40px; height: 40px; object-fit: cover;">
            {% else %}
            <div class="bg-secondary text-white d-flex align-items-center justify-content-center"
                style="width: 40px; height: 40px; font-size: 1.2rem;">
                {{ comment.comment_author.username|slice:":1" }}
            </div>
            {% endif %}
        </a>
    </div>

    <!-- Content Section -->
    <div class="flex-grow-1">
        <!-- Header: Author & Time -->
        <div class="mb-1 d-flex align-items-baseline gap-2">
            <a href="{% url 'user_urls:profile' comment.comment_author.username %}"
                class="text-reset fw-bold small text-decoration-none">@{{ comment.comment_author.username }}</a>
            <small class="text-secondary" style="font-size: 0.75rem;">{{ comment.comment_date|timesince }} ago</small>
        </div>

        <!-- Comment Body -->
        <div class="text-secondary mb-2" style="font-size: 0.95rem; line-height: 1.5;">
            {{ comment.comment_content }}
        </div>

        <!-- Action Bar (Minimalist) -->
        <div class="d-flex gap-3 align-items-center">
            <button class="btn btn-sm btn-link text-secondary p-0 text-decoration-none reply-btn"
                data-target="#reply-form-{{ comment.id }}" style="font-size: 0.8rem;">reply</button>
        </div>

        <!-- Inline Reply Form (Hidden by default) -->
        {% if user.is_authenticated %}
        <div id="reply-form-{{ comment.id }}" class="mt-3 d-none">
            <form action="{% url 'article_urls:comment' article.id %}" method="POST">
                {% csrf_token %}
                <input type="hidden" name="parent_id" value="{{ comment.id }}">
                <div class="d-flex gap-2">
                    <textarea name="comment_content" class="form-control" rows="1" placeholder="Add a reply..."
                        style="resize: none; font-size: 0.9rem; border: none; background: transparent; border-bottom: 1px solid var(--border-color); border-radius: 0; padding-left: 0;"></textarea>
                </div>
                <div class="text-end mt-2">
                    <button type="button"
                        class="btn btn-link btn-sm text-secondary text-decoration-none me-2 cancel-inline-reply-btn"
                        data-target="#reply-form-{{ comment.id }}">cancel</button>
                    <button type="submit" class="btn btn-primary btn-sm rounded-pill px-3">reply</button>
                </div>
            </form>
        </div>
        {% endif %}

        <!-- Nested Replies -->
        {% if comment.replies.count > 0 %}
        <div class="mt-2">
            <button class="btn btn-sm btn-link text-primary p-0 text-decoration-none fw-bold toggle-replies-btn"
                data-bs-target="#replies-{{ comment.id }}" style="font-size: 0.8rem;">
                &#x25BC; show {{ comment.replies.count }} replies
            </button>

            <div id="replies-{{ comment.id }}" class="mt-3 ps-3 border-start border-light d-none">
                {% for reply in comment.replies.all %}
                {% with comment=reply %}
                {% include "article/comment_item.html" %}
                {% endwith %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</div>